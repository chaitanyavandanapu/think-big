<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Collection</title>
  <style>
    .gallery {
      display: flex;
      flex-wrap: wrap;
    }
    .product-card {
      margin: 10px;
      width: 200px;
      border: 1px solid #ddd;
      padding: 10px;
    }
    .product-card img {
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>Product Collection</h1>
  <div class="gallery" id="product-gallery"></div>

  <script>
    async function fetchProducts() {
      const githubUrl = 'https://raw.githubusercontent.com/chaitanyavandanapu/think-big/main/data/products.json';

      // Extract categoryId from URL
      const pathParts = window.location.pathname.split('/');
      console.log(pathParts);
      let categoryId = pathParts.length > 2 ? pathParts[2].toLowerCase() : null;

      // If no category is found, display an error message
      if (!categoryId) {
        console.error('Category ID not found in URL.');
        document.body.innerHTML = '<h1>Category ID not found in URL</h1>';
        return;
      }

      console.log('Category ID:', categoryId);  // Log category ID for debugging

      try {
        const response = await fetch(githubUrl);
        console.log('GitHub Response Status:', response.status);  // Check if the response is OK

        if (!response.ok) {
          throw new Error('Error fetching data from GitHub');
        }

        const data = await response.json();
        console.log('Fetched Data:', data);  // Log the fetched data

        // Check if the categoryId exists in the data
        const categoryData = data[categoryId];
        console.log('Category Data:', categoryData);  // Log the category data

        if (!categoryData || !categoryData.products || categoryData.products.length === 0) {
          document.body.innerHTML = '<h1>Category Not Found</h1>';
          return;
        }

        // Generate product cards HTML
        const productCards = categoryData.products.map(product => `
          <div class="product-card">
            <a href="#" id="image-${product.id}">
              <div class="image-container">
                <img src="${product.imageSrc}" alt="${product.name}" loading="lazy" />
              </div>
              <div class="product-info">
                <div class="product-name">${product.name}</div>
                <div class="product-category">${product.subCategory || 'General'}</div>
              </div>
            </a>
          </div>
        `).join('');

        // Insert the generated product cards into the gallery
        document.getElementById('product-gallery').innerHTML = productCards;

      } catch (err) {
        console.error(err);
        document.body.innerHTML = '<h1>Error fetching or processing data</h1>';
      }
    }

    // Call the function to fetch products and render them
    fetchProducts();
  </script>
</body>
</html>
